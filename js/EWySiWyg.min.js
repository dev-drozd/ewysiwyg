/**
 * EWySiWyg editor
 * Version: 1.0
 * Copyright: Oleksandr Drozd <dev.drozd@gmail.com>.
*/
$.fn.EWySiWyg=function(e){var t="object"==typeof e?e:Object.assign({plugins:"*",spellcheck:!0},e);this.each(function(){var e=this;e.className="ewswg-body",e.style.display="none",$(e).bind("paste blur",function(){e.parentNode.querySelector("div.ewswg-body").innerHTML=e.value});var n=$("<div/>",{class:"ewswg-body",contenteditable:!0,spellcheck:t.spellcheck,html:e.value}).bind("mousedown",function(e){"A"===e.target.tagName&&$.EWySiWyg.editLink(e)}).bind("paste blur",function(){e.value=this.innerHTML}),i=$("<div/>",{class:"ewswg-head"}),o=$("<div/>",{class:"ewswg",html:i}).append(n);$.EWySiWyg.body=n,$.EWySiWyg.textarea=e,$.each($.EWySiWyg.methods,function(e,o){var a=t.plugins;return a&&"*"!==a?a.replace(/\s+/g,"").split(",").indexOf(e)>=0?o.apply($.EWySiWyg,[i,n]):null:o.apply($.EWySiWyg,[i,n])}),$(e).after(o).appendTo(o)})},$.EWySiWyg=new function(e,t){this.lang={resize:"Full Screen",undo:"Back",redo:"Forward",bold:"Bold",italic:"italic",strike:"strikeout",underline:"underlined",left:"Align Left",center:"Centered",right:"Align Right",list:"List",numlist:"Numbered list",quote:"Tsytata",hr:"Horizontal Line",format:"Format",code:"Show code",color:"Text Color",background:"The background color of the text",text:"Text",size:"font size",header:"Title"},this.modal=function(e){$("<div/>",{class:"ewswg-modal",html:$("<div/>",{html:"<div>"+e.title+"<i onclick=\"$(this).parents('.ewswg-modal').remove()\">&#10006;</i></div>"+e.content})}).appendTo("body")},this.editLink=function(e,t,n){var i=this;if(t)var o=i.getSelection(),a=i.getRange(i.body,e),l="";else var c=$(e.target),o=c.html(),l=c.attr("href");this.modal({title:"Adding link",content:'<div>				<label>Text:</label>				<input type="text" name="text" value="'+o+'">			</div>			<div>				<label>Link:</label>				<input type="text" name="link" value="'+l+'">			</div>			<div>				<button>Insert</button>			</div>'}),$(".ewswg-modal button").click(function(){var l=$('.ewswg-modal input[name="text"]').val(),s=$('.ewswg-modal input[name="link"]').val();t?(o.removeAllRanges(),a&&o.addRange(a),console.log(i.body[0],'<a href="'+s+'" target="blank_">'+l+"</a>"),i.command(n,"insertHTML",!1,'<a href="'+s+'" target="blank_">'+l+"</a>",e)):c.html(l).attr("href",s),$(".ewswg-modal").remove()})},this.getSelection=function(){return e.getSelection?e.getSelection():""},this.command=function(e,n,i,o,a){a.preventDefault();var l=this.getSelection(e),c=!1;if(l&&l.rangeCount){var s=l.getRangeAt(0);c=s.commonAncestorContainer||(s.parentElement?s.parentElement():s.item(0))}for(;c&&c!=e[0];)c=c.parentNode;c||this.setFocus(e[0],!1,!0),t.execCommand(n,i,o)},this.getRange=function(e,t){t.preventDefault();var n=this.getSelection(e);return n.rangeCount?n.getRangeAt(0):null},this.setFocus=function(n){if(void 0!==e.getSelection&&void 0!==t.createRange){var i=e.getSelection(),o=t.createRange();o.selectNodeContents(n),o.collapse(!1);var i=e.getSelection();i.removeAllRanges(),i.addRange(o)}else if(void 0!==t.body.createTextRange){var o=t.body.createTextRange();o.moveToElementText(n),o.collapse(!1),o.select()}},this.createButton=function(e,t){function n(e,t){$.each(t,function(t,n){$.each(n,function(n,i){var o=$("<i/>",{class:n,title:t});if("function"==typeof i)o.mousedown(i);else var o=$("<div/>",{html:o}).append($("<div/>",{class:"ewswg-drop"+(i[2]?" "+i[2]:""),html:i[0]}).mousedown(i[1]));$(e).append(o),window.ff=o})})}if(t.length){var i=$("<div/>").appendTo(e);$.each(t,function(){n(i,this)})}else n(e,t)},this.methods={resize:function(e,t){var n=this.lang.resize;console.log(this.lang.resize),this.createButton(e,{[n]:{"icon-resize-full ewswg-resize":function(t){$(e).parent().hasClass("ewswg-full-screen")?($("body").css("overflow",""),$(e).find(".ewswg-resize").addClass("fa-expand").removeClass("fa-compress").parents(".ewswg").removeClass("ewswg-full-screen")):($(e).find(".ewswg-resize").removeClass("fa-expand").addClass("fa-compress").parents(".ewswg").addClass("ewswg-full-screen"),$("body").css("overflow","hidden"))}}})},style:function(e,t){var n=this,i=n.lang,o=i.bold;i.italic,i.strike,i.underline,this.createButton(e,[{[o]:{"icon-bold":function(e){console.log("work",e),n.command(t,"bold",!1,null,e)}}},{italic:{"icon-italic":function(e){n.command(t,"italic",!1,null,e)}}},{strike:{"icon-strike":function(e){n.command(t,"strikeThrough",!1,null,e)}}},{underline:{"icon-underline":function(e){n.command(t,"underline",!1,null,e)}}}])},aligment:function(e,t){var n=this,i=n.lang;i.left,i.center,i.right,this.createButton(e,[{left:{"icon-align-left":function(e){n.command(t,"justifyLeft",!1,null,e)}}},{center:{"icon-align-center":function(e){n.command(t,"justifyCenter",!1,null,e)}}},{right:{"icon-align-right":function(e){n.command(t,"justifyRight",!1,null,e)}}},{full:{"icon-align-justify":function(e){n.command(t,"justifyFull",!1,null,e)}}}])},indent:function(e,t){var n=this,i=n.lang;i.indent,i.outdent,this.createButton(e,[{indent:{"icon-indent-right":function(e){n.command(t,"indent",!1,null,e)}}},{outdent:{"icon-indent-left":function(e){n.command(t,"outdent",!1,null,e)}}}])},list:function(e,t){var n=this,i=n.lang;i.list,i.numlist,this.createButton(e,[{list:{"icon-list":function(e){n.command(t,"insertUnorderedList",!1,null,e)}}},{numlist:{"icon-list-numbered":function(e){n.command(t,"insertOrderedList",!1,null,e)}}}])},insert:function(e,t){for(var n=this,i=n.lang,o=(i.quote,i.hr,""),a=10,l=0,c=1;c<=100;c++){l<10?l++:l=1;var s=10*l;o+='<span data-row="'+c+'" style="width:'+a+"%;height:"+s+"%;z-index:"+(100-c)+'" title="'+s/10+","+a/10+'"></span>',100==s&&(a+=10)}this.createButton(e,[{quote:{"icon-quote-left":function(e){var i=n.getSelection(t);i&&n.command(t,"insertHTML",!1,"<blockquote>"+i+"</blockquote>&nbsp;",e)}}},{hr:{"icon-minus":function(e){n.command(t,"InsertHorizontalRule",!0,"",e)}}},{link:{"icon-link":function(e){n.editLink(e,!0,t)}}},{table:{"icon-table":[o,function(e){var i=e.target.getAttribute("title"),o="",a=n.getSelection(),l=n.getRange(t,e);if(i){for(var c=i.split(","),s=0;s<c[0];s++){o+="<tr>";for(var r=0;r<c[1];r++)o+="<td>&#65279;</td>";o+="</tr>"}a.removeAllRanges(),l&&a.addRange(l),n.command(t,"insertHTML",!1,'<table cellspacing="5" cellpadding="0">'+o+"</table>&nbsp;",e)}},"ewswg-table"]}},{image:{"icon-picture":function(e){var i=n.getSelection(),o=n.getRange(t,e);location.pathname.split("/"),n.modal({title:"Insert Image",content:'<div>								<label>URL:</label>								<input type="text" name="url" autofocus>							</div>							<div>								<button class="btn btnSubmit">Insert</button>							</div>'}),$(".ewswg-modal button").click(function(){var a=$('.ewswg-modal input[name="url"]').val();i.removeAllRanges(),o&&i.addRange(o),n.command(t,"insertHTML",!1,'<img src="'+a+'">&nbsp;',e),$(".ewswg-modal").remove()})}}},{youtube:{"icon-youtube":function(e){var i=n.getSelection(),o=n.getRange(t,e);console.log(this),n.modal({title:"Youtube link",content:'<div>								<label>URL:</label>								<input type="text" name="url" autofocus>							</div>							<div>								<button class="btn btnSubmit">Insert</button>							</div>'}),$(".ewswg-modal button").click(function(){var a=$('.ewswg-modal input[name="url"]').val().match(/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/);a&&11===a[1].length?(i.removeAllRanges(),o&&i.addRange(o),n.command(t,"insertHTML",!1,'<iframe src="//www.youtube.com/embed/'+a[1]+'" frameborder="0" width="640" height="360"></iframe>&nbsp;',e),$(".ewswg-modal").remove()):alert("Ссылка не верная")})}}}])},code:function(e,t){var n=this,i=n.lang;i.format,i.code,this.createButton(e,[{format:{"icon-eraser":function(e){n.getSelection(t)&&n.command(t,"removeFormat",!1,null,e)}}},{code:{"icon-code":function(n){if(t.code)t.show().next().hide(),t.code=!1,$(e).parent().find(".ewswg-head i:not(.icon-code):not(.ewswg-resize)").removeClass("disabled");else{var i=t.hide().next().show();i.val(i.val().trim()),t.code=!0,$(e).parent().find(".ewswg-head i:not(.icon-code):not(.ewswg-resize)").addClass("disabled")}}}}])},font:function(e,t){var n=this,i=n.lang,o=(i.color,i.background,i.family,i.size,i.header),a="",l="<ul>",c="<ul>",s="<ul>";$.each(["#fff","#000","#eee","#f00","#00f","#F2FB5B","#EB981B","#EB567F","#C625DA","#6DBDF5","#5BD4B8","#44C06A","#6FE760","#C2C2C2","#464646","#6bc4c2","#45bb6f","#25a6d0","#25a6d0"],function(){a+='<span data-color="'+this+'" style="background: '+this+'"></span>'}),$.each(["cursive","fantasy","monospace","sans-serif","serif"],function(){l+='<li data-family="'+this+'" style="font-family:'+this+';">'+this+"</li>"});for(var r=1;r<=7;r++)c+='<li data-size="'+r+'"><font size="'+r+'" data-size="'+r+'">'+i.text+"</font></li>";for(var r=1;r<=6;r++)s+='<li data-header="'+r+'" class="h'+r+'">'+o+" "+r+"</li>";this.createButton(e,[{color:{"icon-adjust":[a,function(e){var i=e.target.getAttribute("data-color");i&&n.command(t,"foreColor",!0,i,e)},"color"]}},{background:{"icon-th":[a,function(e){var i=e.target.getAttribute("data-color");i&&n.command(t,"backColor",!0,i,e)},"color"]}},{family:{"icon-font":[l+"</ul>",function(e){var i=e.target.getAttribute("data-family");i&&n.command(t,"fontName",!0,i,e)},"family"]}},{size:{"icon-text-height":[c+"</ul>",function(e){var i=e.target.getAttribute("data-size");i&&n.command(t,"fontSize",!0,i,e)},"size"]}},{header:{"icon-header":[s+"</ul>",function(e){var i=e.target.getAttribute("data-header");i&&n.command(t,"formatBlock",!0,"H"+i,e)},"ewswg-header"]}}])},history:function(e,t){var n=this,i=n.lang;i.undo,i.redo,this.createButton(e,[{undo:{"icon-ccw":function(e){n.command(t,"undo",!1,null,e)}}},{redo:{"icon-cw":function(e){n.command(t,"redo",!1,null,e)}}}])}}}(window,document);